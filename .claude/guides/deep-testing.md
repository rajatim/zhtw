# ZHTW 深度測試計畫

## 目標

確認 zhtw 能正確處理各種繁簡轉換情境，評估詞庫完整度。

---

## 現況盤點

### 詞庫規模

| 分類 | 詞條數 | 說明 |
|------|--------|------|
| common.json | 900 | 通用詞彙（最大） |
| chars.json | 688 | 一字多義處理 |
| daily.json | 232 | 每日用語 |
| medical.json | 230 | 醫療術語 |
| it.json | 200 | 資訊科技 |
| base.json | 178 | UI/基礎術語 |
| legal.json | 173 | 法律術語 |
| geography.json | 166 | 地名 |
| gaming.json | 150 | 遊戲術語 |
| finance.json | 146 | 金融術語 |
| ecommerce.json | 116 | 電商術語 |
| education.json | 113 | 教育術語 |
| business.json | 81 | 商業術語 |
| **總計** | **3,481** | |

### Identity Mappings（防誤轉）

共 65 條，覆蓋：
- 只（只有/只是 vs 一隻）
- 後（皇后 vs 之後）
- 發/髮、乾/幹、製/制 等一字多義

---

## 測試方法論

### 1. 單元測試（現有 208 tests）

```
tests/
├── test_char_conversion.py    # 字元轉換
├── test_converter.py          # 轉換核心
├── test_matcher.py            # 匹配演算法
├── test_dictionary.py         # 詞庫載入
└── ...
```

### 2. 邊界案例測試

測試原理：針對容易出錯的情境設計測試案例

```python
test_cases = [
    # === 一字多義 ===
    ("只有一隻猫", "只有一隻貓"),      # 只→隻（量詞）
    ("皇后驾到", "皇后駕到"),          # 後→後（皇后保持）
    ("之後再說", "之後再說"),          # 後→後（時間）
    ("頭髮很長", "頭髮很長"),          # 發→髮
    ("發現問題", "發現問題"),          # 發→發
    ("乾淨利落", "乾淨俐落"),          # 幹→乾
    ("幹部培訓", "幹部培訓"),          # 幹→幹

    # === 術語轉換 ===
    ("軟體開發", "軟體開發"),          # IT術語
    ("使用者介面", "使用者介面"),        # IT術語
    ("程式員寫程式碼", "程式設計師寫程式碼"),

    # === 醫療術語 ===
    ("做超音波檢查", "做超音波檢查"),
    ("愛滋病預防", "愛滋病預防"),

    # === 地名 ===
    ("雪梨歌劇院", "雪梨歌劇院"),
]
```

### 3. 準確度測試結果

**當前狀態：10/15 通過 (66%)**

| 狀態 | 案例 | 問題 |
|------|------|------|
| ✅ | 之後→之後 | 正確 |
| ✅ | 頭髮→頭髮 | 正確 |
| ✅ | 發現→發現 | 正確 |
| ✅ | 幹部→幹部 | 正確 |
| ✅ | 軟體→軟體 | 正確 |
| ✅ | 使用者→使用者 | 正確 |
| ✅ | 超音波→超音波 | 正確 |
| ✅ | 愛滋→愛滋 | 正確 |
| ✅ | 雪梨→雪梨 | 正確 |
| ✅ | 列印→列印 | 正確 |
| ❌ | 猫→貓 | 字元缺失 |
| ❌ | 驾→駕 | 字元缺失 |
| ❌ | 程式員→程式設計師 | 簡體 key 缺失 |
| ❌ | 優盤→隨身碟 | 術語缺失 |
| ⚠️ | 利落→俐落 | 兩者皆可 |

---

## 發現的問題

### P0 - 字元轉換缺失

詞庫缺少基礎簡繁字元對應：

```
猫 → 貓
驾 → 駕
```

**影響**：所有包含這些字的文字都無法正確轉換

### P1 - 術語 key 格式不一致

詞庫中 `程式設計師 → 程式設計師` 使用繁體 key，
但輸入是簡體 `程式員`，導致無法匹配。

**解決方案**：術語應該用簡體 key

### P2 - 術語覆蓋不足

缺少常見術語如 `優盤 → 隨身碟`

---

## 產業覆蓋分析

### 已有產業

| 產業 | 檔案 | 詞條數 | 完整度 |
|------|------|--------|--------|
| IT/科技 | it.json | 200 | ⭐⭐⭐ |
| 醫療 | medical.json | 230 | ⭐⭐⭐ |
| 法律 | legal.json | 173 | ⭐⭐⭐ |
| 金融 | finance.json | 146 | ⭐⭐ |
| 電商 | ecommerce.json | 116 | ⭐⭐ |
| 教育 | education.json | 113 | ⭐⭐ |
| 遊戲 | gaming.json | 150 | ⭐⭐⭐ |
| 商業 | business.json | 81 | ⭐⭐ |
| 地理 | geography.json | 166 | ⭐⭐⭐ |

### 缺少的產業

- 製造業/工業
- 建築/房地產
- 餐飲/飯店
- 媒體/新聞
- 娛樂/影視
- 體育/運動
- 農業
- 能源/環保
- 政府/公共行政

---

## 測試專家角色

### 語言專家
- **台灣母語者**：驗證轉換結果符合台灣用語
- **中國母語者**：提供真實簡體樣本
- **香港母語者**：測試 HK→TW 轉換
- **語言學者**：一字多義語境判斷

### 領域專家
- **IT 工程師**：軟體術語
- **醫療人員**：醫療術語
- **法律/財經專業**：正式文書用語

### 技術測試
- **QA 工程師**：邊界條件、效能
- **文字編輯**：大量文字校對
- **NLP 專家**：LLM 模式準確度

---

## 改進計畫

### Phase 1：修復基礎字元（P0）

補齊缺失的簡繁字元對應：
```
猫→貓、驾→駕、...
```

### Phase 2：統一術語 key 格式（P1）

確保所有術語使用簡體 key：
```
程式員 → 程式設計師  ✓
程式設計師 → 程式設計師  ✗（應該用簡體 key）
```

### Phase 3：擴充術語（P2）

補充常見但缺失的術語：
```
優盤 → 隨身碟
...
```

### Phase 4：擴充產業詞庫

優先順序：
1. 媒體/新聞（內容產業常用）
2. 製造業（台灣產業特色）
3. 政府/公共行政（公文常用）

---

## 自動化測試腳本

```python
# tests/test_edge_cases.py
import pytest
from zhtw.converter import convert_file
from zhtw.matcher import Matcher
from zhtw.dictionary import load_dictionary

@pytest.fixture
def matcher():
    return Matcher(load_dictionary())

@pytest.mark.parametrize("source,expected,desc", [
    ("只有一隻猫", "只有一隻貓", "只→隻"),
    ("皇后驾到", "皇后駕到", "後保持"),
    # ... more cases
])
def test_edge_cases(matcher, source, expected, desc, tmp_path):
    test_file = tmp_path / "test.txt"
    test_file.write_text(source, encoding="utf-8")
    convert_file(str(test_file), matcher, fix=True)
    assert test_file.read_text(encoding="utf-8").strip() == expected, desc
```

---

## 指標定義

| 指標 | 計算方式 | 目標 |
|------|----------|------|
| 準確率 | 正確轉換 / 總測試案例 | >95% |
| 覆蓋率 | 有規則的字詞 / 常用簡體字詞 | >90% |
| 誤轉率 | 錯誤轉換 / 總轉換數 | <1% |

---

*最後更新：2026-01-03*
